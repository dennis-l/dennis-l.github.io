<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>LaTeX citation-key extractor</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            :root{
            --bg:#f5f6fa;
            --fg:#2f3542;
            --accent:#3742fa;
            --accentHi:#5149e8;
            --border:#d1d5db;
            }
            *{box-sizing:border-box;}
            body{margin:0;display:flex;height:100vh;background:var(--bg);color:var(--fg);font-family:Inter,Helvetica,Arial,sans-serif;font-size:15px;}
            .split{width:50%;display:flex;flex-direction:column;padding:24px;}
            label{font-weight:600;margin-bottom:8px;font-size:14px;text-transform:uppercase;letter-spacing:.5px;color:#444;}
            textarea{flex:1 1 auto;border:1px solid var(--border);background:#fff;resize:none;padding:12px;font-family:'SF Mono',Menlo,monospace;font-size:14px;line-height:1.45;color:#111;}
            textarea:focus{outline:none;border-color:var(--accent);}
            .panel{flex:0 0 auto;display:flex;align-items:center;justify-content:space-between;margin-top:14px;}
            button{padding:8px 18px;font-weight:600;border:1px solid var(--accent);background:var(--accent);color:#fff;cursor:pointer;transition:background .15s;}
            button:hover{background:var(--accentHi);}
            #keys{min-height:160px;}
            #log{flex:0 0 100px;margin-top:14px;border:1px solid var(--border);background:#fff;padding:10px;font-family:'SF Mono',Menlo,monospace;font-size:13px;color:#555;overflow-y:auto;}
            @media(max-width:800px){
            body{flex-direction:column;}
            .split{width:100%;height:50%;}
            }
        </style>
    </head>
    <body>
        <div class="split">
            <label for="src">LaTeX source</label>
            <textarea id="src" placeholder="Paste your article hereâ€¦"></textarea>
            <div class="panel"><button id="go">Extract keys</button></div>
        </div>
        <div class="split">
            <label for="keys">Citation keys</label>
            <textarea id="keys" readonly></textarea>
            <div class="panel">
                <span id="stat"></span>
                <button id="save">Download keys.txt</button>
            </div>
            <div id="log"></div>
        </div>
        <script>
            const citeRe= /\\(?:cit(?:ep?|et|author|year|alt|alp|yearpar)|fullcitet?|footcite|autocite|parencite|textcite)(?:\s*\[[^\]]*?\]){0,2}\s*\{([^}]+)\}/g;
            const srcEl  = document.getElementById('src');
            const outEl  = document.getElementById('keys');
            const statEl = document.getElementById('stat');
            const logEl  = document.getElementById('log');
            
            function extract(){
              const seen=new Set(); let m;
              while((m=citeRe.exec(srcEl.value))!==null){
                m[1].split(/\s*,\s*/).filter(Boolean).forEach(k=>seen.add(k));
              }
              const list=[...seen].sort((a,b)=>a.localeCompare(b));
              outEl.value=list.join('\n');
              statEl.textContent=`${list.length} unique key${list.length===1?'':'s'}`;
              logEl.textContent=list.length?'Ready':'No keys found';
            }
            document.getElementById('go').addEventListener('click',extract);
            document.getElementById('save').addEventListener('click',()=>{
              const blob=new Blob([outEl.value],{type:'text/plain'});
              const a=document.createElement('a');
              a.href=URL.createObjectURL(blob);
              a.download='keys.txt';
              a.click();
            });
            srcEl.addEventListener('input',extract);
            extract();
        </script>
    </body>
</html>